<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MapLocationApp.Views.FaceRecognitionPage"
             Title="人臉辨識"
             Style="{StaticResource DarkPageStyle}">

    <ContentPage.Resources>
        <ResourceDictionary Source="../Resources/Styles/DarkTheme.xaml" />
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">
            
            <!-- 標題區域 -->
            <Frame Style="{StaticResource CardFrameStyle}">
                <VerticalStackLayout Spacing="10" HorizontalOptions="Center">
                    <Label Text="👤" FontSize="48" HorizontalOptions="Center"/>
                    <Label Text="AI 人臉辨識系統" Style="{StaticResource TitleLabelStyle}" HorizontalOptions="Center"/>
                    <Label Text="智慧人臉訓練與識別平台" Style="{StaticResource LabelStyle}" HorizontalOptions="Center"/>
                </VerticalStackLayout>
            </Frame>

            <!-- 功能選擇區域 -->
            <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="*,*" RowSpacing="16" ColumnSpacing="16">
                
                <!-- 訓練模式 -->
                <Frame Grid.Row="0" Grid.Column="0" Style="{StaticResource CardFrameStyle}">
                    <VerticalStackLayout Spacing="12" HorizontalOptions="Center">
                        <Label Text="🎓" FontSize="36" HorizontalOptions="Center"/>
                        <Label Text="訓練模式" Style="{StaticResource LabelStyle}" FontSize="18" FontAttributes="Bold" HorizontalOptions="Center"/>
                        <Label Text="新增人臉資料到系統" Style="{StaticResource SmallLabelStyle}" HorizontalOptions="Center" HorizontalTextAlignment="Center"/>
                        <Button Text="開始訓練" Style="{StaticResource PrimaryButtonStyle}" 
                                Clicked="OnTrainingModeClicked" WidthRequest="120"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- 測試模式 -->
                <Frame Grid.Row="0" Grid.Column="1" Style="{StaticResource CardFrameStyle}">
                    <VerticalStackLayout Spacing="12" HorizontalOptions="Center">
                        <Label Text="🔍" FontSize="36" HorizontalOptions="Center"/>
                        <Label Text="測試模式" Style="{StaticResource LabelStyle}" FontSize="18" FontAttributes="Bold" HorizontalOptions="Center"/>
                        <Label Text="辨識已訓練的人臉" Style="{StaticResource SmallLabelStyle}" HorizontalOptions="Center" HorizontalTextAlignment="Center"/>
                        <Button Text="開始測試" Style="{StaticResource SuccessButtonStyle}" 
                                Clicked="OnTestModeClicked" WidthRequest="120"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- 管理模式 -->
                <Frame Grid.Row="1" Grid.Column="0" Style="{StaticResource CardFrameStyle}">
                    <VerticalStackLayout Spacing="12" HorizontalOptions="Center">
                        <Label Text="📊" FontSize="36" HorizontalOptions="Center"/>
                        <Label Text="資料管理" Style="{StaticResource LabelStyle}" FontSize="18" FontAttributes="Bold" HorizontalOptions="Center"/>
                        <Label Text="查看和管理人臉資料" Style="{StaticResource SmallLabelStyle}" HorizontalOptions="Center" HorizontalTextAlignment="Center"/>
                        <Button Text="管理資料" Style="{StaticResource SecondaryButtonStyle}" 
                                Clicked="OnManagementModeClicked" WidthRequest="120"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- 系統設定 -->
                <Frame Grid.Row="1" Grid.Column="1" Style="{StaticResource CardFrameStyle}">
                    <VerticalStackLayout Spacing="12" HorizontalOptions="Center">
                        <Label Text="⚙️" FontSize="36" HorizontalOptions="Center"/>
                        <Label Text="系統設定" Style="{StaticResource LabelStyle}" FontSize="18" FontAttributes="Bold" HorizontalOptions="Center"/>
                        <Label Text="調整識別參數設定" Style="{StaticResource SmallLabelStyle}" HorizontalOptions="Center" HorizontalTextAlignment="Center"/>
                        <Button Text="系統設定" Style="{StaticResource SecondaryButtonStyle}" 
                                Clicked="OnSystemSettingsClicked" WidthRequest="120"/>
                    </VerticalStackLayout>
                </Frame>

            </Grid>

            <!-- 工作區域 -->
            <Frame x:Name="WorkAreaFrame" Style="{StaticResource CardFrameStyle}" IsVisible="False">
                <StackLayout x:Name="WorkAreaContent" Spacing="15">
                    <Label x:Name="WorkAreaTitle" Text="" Style="{StaticResource LabelStyle}" FontSize="16" FontAttributes="Bold" HorizontalOptions="Center"/>
                    <!-- 動態內容將在這裡載入 -->
                </StackLayout>
            </Frame>

            <!-- 影像選擇區域 -->
            <Frame x:Name="ImageFrame" Style="{StaticResource CardFrameStyle}" IsVisible="False">
                <VerticalStackLayout Spacing="15">
                    <Label Text="選擇影像" Style="{StaticResource LabelStyle}" FontSize="16" FontAttributes="Bold"/>
                    
                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="10">
                        <Button Grid.Column="0" Text="📷 拍照" Style="{StaticResource PrimaryButtonStyle}" 
                                Clicked="OnTakePhotoClicked"/>
                        <Button Grid.Column="1" Text="📁 選擇檔案" Style="{StaticResource SecondaryButtonStyle}" 
                                Clicked="OnSelectFileClicked"/>
                        <Button Grid.Column="2" Text="❌ 取消" Style="{StaticResource SecondaryButtonStyle}" 
                                Clicked="OnCancelClicked"/>
                    </Grid>

                    <!-- 影像預覽 -->
                    <Image x:Name="PreviewImage" 
                           HeightRequest="300" 
                           WidthRequest="300"
                           Aspect="AspectFit"
                           BackgroundColor="#2D2D30"
                           IsVisible="False"/>

                    <!-- 處理按鈕 -->
                    <StackLayout x:Name="ProcessingButtons" Orientation="Horizontal" HorizontalOptions="Center" Spacing="10" IsVisible="False">
                        <Button x:Name="ProcessButton" Text="🔄 處理影像" Style="{StaticResource PrimaryButtonStyle}" 
                                Clicked="OnProcessImageClicked"/>
                        <Button Text="🗑️ 重新選擇" Style="{StaticResource SecondaryButtonStyle}" 
                                Clicked="OnResetClicked"/>
                    </StackLayout>

                    <!-- 名稱輸入 (訓練模式) -->
                    <StackLayout x:Name="NameInputArea" IsVisible="False" Spacing="10">
                        <Label Text="請輸入人臉名稱:" Style="{StaticResource LabelStyle}"/>
                        <Entry x:Name="NameEntry" Placeholder="例如: 張三" Style="{StaticResource DarkEntryStyle}"/>
                        <Button Text="💾 儲存人臉" Style="{StaticResource SuccessButtonStyle}" 
                                Clicked="OnSaveFaceClicked"/>
                    </StackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- 結果顯示區域 -->
            <Frame x:Name="ResultFrame" Style="{StaticResource CardFrameStyle}" IsVisible="False">
                <VerticalStackLayout Spacing="15">
                    <Label Text="處理結果" Style="{StaticResource LabelStyle}" FontSize="16" FontAttributes="Bold"/>
                    <Label x:Name="ResultLabel" Style="{StaticResource LabelStyle}" HorizontalTextAlignment="Center"/>
                    
                    <!-- 偵測到的人臉資訊 -->
                    <CollectionView x:Name="DetectedFacesCollection" IsVisible="False">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="10" ColumnDefinitions="60,*,80" RowDefinitions="Auto,Auto">
                                    <Label Grid.Column="0" Grid.Row="0" Text="👤" FontSize="24" VerticalOptions="Center"/>
                                    <Label Grid.Column="1" Grid.Row="0" Text="{Binding Name}" Style="{StaticResource LabelStyle}" FontAttributes="Bold"/>
                                    <Label Grid.Column="2" Grid.Row="0" Text="{Binding Confidence, StringFormat='{0:P1}'}" Style="{StaticResource SmallLabelStyle}" HorizontalTextAlignment="End"/>
                                    <Label Grid.Column="1" Grid.Row="1" Text="{Binding StatusText}" Style="{StaticResource SmallLabelStyle}"/>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>

            <!-- 系統狀態資訊 -->
            <Frame Style="{StaticResource CardFrameStyle}">
                <VerticalStackLayout Spacing="12">
                    <Label Text="系統狀態" Style="{StaticResource LabelStyle}" FontSize="16" FontAttributes="Bold"/>
                    
                    <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto" RowSpacing="6" ColumnSpacing="10">
                        <Label Grid.Row="0" Grid.Column="0" Text="🤖" FontSize="16"/>
                        <Label Grid.Row="0" Grid.Column="1" x:Name="SystemStatusLabel" Text="FaceAiSharp 系統: 準備就緒" Style="{StaticResource SmallLabelStyle}"/>
                        
                        <Label Grid.Row="1" Grid.Column="0" Text="📊" FontSize="16"/>
                        <Label Grid.Row="1" Grid.Column="1" x:Name="DatabaseStatusLabel" Text="資料庫: 載入中..." Style="{StaticResource SmallLabelStyle}"/>
                        
                        <Label Grid.Row="2" Grid.Column="0" Text="💾" FontSize="16"/>
                        <Label Grid.Row="2" Grid.Column="1" x:Name="StorageStatusLabel" Text="儲存空間: 可用" Style="{StaticResource SmallLabelStyle}"/>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- 說明文字 -->
            <Label Text="提示：Windows 平台支援完整的 FaceAiSharp 人臉辨識功能，包括高精度的人臉偵測和識別。" 
                   Style="{StaticResource SmallLabelStyle}" 
                   HorizontalOptions="Center" 
                   HorizontalTextAlignment="Center"
                   Margin="0,10,0,20"/>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>