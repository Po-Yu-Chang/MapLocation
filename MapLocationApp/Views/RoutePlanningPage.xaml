<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="MapLocationApp.Views.RoutePlanningPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:mapsui="clr-namespace:Mapsui.UI.Maui;assembly=Mapsui.UI.Maui"
             Title="è·¯ç·šè¦åŠƒ"
             BackgroundColor="LightGray">

    <!-- æ ¹æ“šå°Žèˆªç‹€æ…‹å‹•æ…‹åˆ‡æ›çš„ä¸»è¦å¸ƒå±€ -->
    <Grid>
        
        <!-- è·¯ç·šè¦åŠƒæ¨¡å¼ (éžå°Žèˆªæ™‚é¡¯ç¤º) -->
        <Grid x:Name="RoutePlanningMode" 
              IsVisible="{Binding IsNotNavigating}"
              RowDefinitions="Auto,*">
            
            <!-- æœå°‹å’ŒæŽ§åˆ¶å€åŸŸ -->
            <StackLayout Grid.Row="0" BackgroundColor="White" Spacing="0">
                
                <!-- èµ·é»žæœå°‹æ¡† -->
                <Border BackgroundColor="White"
                        Stroke="Gray"
                        StrokeShape="RoundRectangle 8"
                        StrokeThickness="1"
                        Padding="0"
                        Margin="16,8">
                    <Grid ColumnDefinitions="24,*,Auto,Auto" ColumnSpacing="8">
                        <Label Grid.Column="0" 
                               Text="ðŸŸ¢" 
                               FontSize="20"
                               VerticalOptions="Center"
                               HorizontalOptions="Center"
                               WidthRequest="24"
                               HeightRequest="24"/>
                        <Entry Grid.Column="1" 
                               x:Name="StartLocationEntry"
                               Placeholder="é¸æ“‡èµ·é»žï¼Œæˆ–åœ¨åœ°åœ–ä¸Šé»žé¸"
                               FontSize="16"
                               TextColor="Black"
                               BackgroundColor="Transparent"
                               PlaceholderColor="Gray"
                               Margin="12,16"
                               TextChanged="OnStartLocationTextChanged"/>
                        <Button Grid.Column="2" 
                                x:Name="UseCurrentLocationButton"
                                Text="ðŸ“"
                                BackgroundColor="Transparent"
                                TextColor="Blue"
                                WidthRequest="40"
                                HeightRequest="40"
                                CornerRadius="20"
                                Clicked="OnUseCurrentLocationClicked"/>
                        <Button Grid.Column="3" 
                                x:Name="SwapLocationsButton"
                                Text="ðŸ”„"
                                BackgroundColor="Transparent"
                                TextColor="Gray"
                                WidthRequest="40"
                                HeightRequest="40"
                                CornerRadius="20"
                                Clicked="OnSwapLocationsClicked"/>
                    </Grid>
                </Border>
                
                <!-- èµ·é»žæœå°‹å»ºè­° -->
                <CollectionView x:Name="StartSuggestionsView" 
                                ItemsSource="{Binding FromSuggestions}"
                                IsVisible="False"
                                BackgroundColor="White"
                                Margin="16,0">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="16,12" BackgroundColor="White">
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnStartSuggestionTapped"/>
                                </Grid.GestureRecognizers>
                                <Grid ColumnDefinitions="Auto,*">
                                    <Label Grid.Column="0" Text="ðŸ“" FontSize="18" VerticalOptions="Center"/>
                                    <StackLayout Grid.Column="1" Margin="12,0,0,0">
                                        <Label Text="{Binding MainText}" FontSize="16" TextColor="Black"/>
                                        <Label Text="{Binding SecondaryText}" FontSize="14" TextColor="Gray"/>
                                    </StackLayout>
                                </Grid>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
                
                <!-- é€£æŽ¥ç·š -->
                <StackLayout HorizontalOptions="Start" Margin="40,0,0,0">
                    <BoxView Color="LightGray"
                             WidthRequest="2"
                             HorizontalOptions="Center"
                             Margin="0,4"
                             HeightRequest="8"/>
                    <BoxView Color="LightGray"
                             WidthRequest="2"
                             HorizontalOptions="Center"
                             Margin="0,4"
                             HeightRequest="8"/>
                    <BoxView Color="LightGray"
                             WidthRequest="2"
                             HorizontalOptions="Center"
                             Margin="0,4"
                             HeightRequest="8"/>
                </StackLayout>
                
                <!-- çµ‚é»žæœå°‹æ¡† -->
                <Border BackgroundColor="White"
                        Stroke="Gray"
                        StrokeShape="RoundRectangle 8"
                        StrokeThickness="1"
                        Padding="0"
                        Margin="16,8">
                    <Grid ColumnDefinitions="24,*,Auto" ColumnSpacing="8">
                        <Label Grid.Column="0" 
                               Text="ðŸ”´" 
                               FontSize="20"
                               VerticalOptions="Center"
                               HorizontalOptions="Center"
                               WidthRequest="24"
                               HeightRequest="24"/>
                        <Entry Grid.Column="1" 
                               x:Name="EndLocationEntry"
                               Placeholder="é¸æ“‡ç›®çš„åœ°"
                               FontSize="16"
                               TextColor="Black"
                               BackgroundColor="Transparent"
                               PlaceholderColor="Gray"
                               Margin="12,16"
                               TextChanged="OnEndLocationTextChanged"/>
                        <Button Grid.Column="2" 
                                x:Name="ClearEndLocationButton"
                                Text="âœ•"
                                BackgroundColor="Transparent"
                                TextColor="Gray"
                                WidthRequest="40"
                                HeightRequest="40"
                                CornerRadius="20"
                                Clicked="OnClearEndLocationClicked"/>
                    </Grid>
                </Border>
                
                <!-- çµ‚é»žæœå°‹å»ºè­° -->
                <CollectionView x:Name="EndSuggestionsView" 
                                ItemsSource="{Binding ToSuggestions}"
                                IsVisible="False"
                                BackgroundColor="White"
                                Margin="16,0">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="16,12" BackgroundColor="White">
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnEndSuggestionTapped"/>
                                </Grid.GestureRecognizers>
                                <Grid ColumnDefinitions="Auto,*">
                                    <Label Grid.Column="0" Text="ðŸ“" FontSize="18" VerticalOptions="Center"/>
                                    <StackLayout Grid.Column="1" Margin="12,0,0,0">
                                        <Label Text="{Binding MainText}" FontSize="16" TextColor="Black"/>
                                        <Label Text="{Binding SecondaryText}" FontSize="14" TextColor="Gray"/>
                                    </StackLayout>
                                </Grid>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
                
                <!-- è·¯ç·šé¸é …æŒ‰éˆ• -->
                <StackLayout Orientation="Horizontal" HorizontalOptions="Center" Margin="16,8">
                    <Button x:Name="FastestRouteButton" 
                            Text="ðŸš— æœ€å¿«è·¯ç·š" 
                            BackgroundColor="White"
                            TextColor="Blue"
                            BorderColor="LightGray"
                            BorderWidth="1"
                            CornerRadius="16"
                            HeightRequest="36"
                            FontSize="14"
                            Margin="4"
                            Clicked="OnRouteOptionClicked"/>
                    <Button x:Name="ShortestRouteButton" 
                            Text="ðŸ“ æœ€çŸ­è·¯ç·š" 
                            BackgroundColor="White"
                            TextColor="Blue"
                            BorderColor="LightGray"
                            BorderWidth="1"
                            CornerRadius="16"
                            HeightRequest="36"
                            FontSize="14"
                            Margin="4"
                            Clicked="OnRouteOptionClicked"/>
                    <Button x:Name="EcoRouteButton" 
                            Text="ðŸŒ± ç¯€èƒ½è·¯ç·š" 
                            BackgroundColor="White"
                            TextColor="Blue"
                            BorderColor="LightGray"
                            BorderWidth="1"
                            CornerRadius="16"
                            HeightRequest="36"
                            FontSize="14"
                            Margin="4"
                            Clicked="OnRouteOptionClicked"/>
                </StackLayout>
                
                <!-- è¦åŠƒè·¯ç·šæŒ‰éˆ• -->
                <Button x:Name="GetDirectionsButton" 
                        Text="è¦åŠƒè·¯ç·š" 
                        BackgroundColor="Blue"
                        TextColor="White"
                        FontAttributes="Bold"
                        CornerRadius="20"
                        HeightRequest="48"
                        Margin="16,8"
                        Clicked="OnGetDirectionsClicked"/>
                
                <!-- æ¸¬è©¦å°ŽèˆªæŒ‰éˆ• (æš«æ™‚) -->
                <Button x:Name="TestNavigationButton" 
                        Text="ðŸ§ª æ¸¬è©¦å°Žèˆªæ¨¡å¼" 
                        BackgroundColor="Orange"
                        TextColor="White"
                        FontAttributes="Bold"
                        CornerRadius="20"
                        HeightRequest="48"
                        Margin="16,8"
                        Clicked="OnTestNavigationClicked"/>
            </StackLayout>
            
            <!-- è·¯ç·šè¦åŠƒæ¨¡å¼çš„åœ°åœ– -->
            <Grid Grid.Row="1">
                <mapsui:MapControl x:Name="PlanningMapView" />
                
                <!-- è·¯ç·šçµæžœå¡ç‰‡ -->
                <CollectionView x:Name="RouteOptionsCollectionView" 
                                ItemsSource="{Binding RouteOptions}"
                                IsVisible="False"
                                BackgroundColor="LightGray"
                                VerticalOptions="End"
                                Margin="16">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Border BackgroundColor="White"
                                    Stroke="LightGray"
                                    StrokeShape="RoundRectangle 12"
                                    StrokeThickness="1"
                                    Padding="16"
                                    Margin="0,4">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnRouteOptionSelected"/>
                                </Border.GestureRecognizers>
                                <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="*,Auto,Auto">
                                    
                                    <!-- è·¯ç·šæ™‚é–“å’Œè·é›¢ -->
                                    <StackLayout Grid.Row="0" Grid.Column="0" Orientation="Horizontal" Spacing="8">
                                        <Label Text="{Binding Duration}" 
                                               FontSize="24"
                                               FontAttributes="Bold"
                                               TextColor="Blue"/>
                                        <Label Text="{Binding Distance}" 
                                               FontSize="16"
                                               TextColor="Gray"
                                               VerticalOptions="End"/>
                                    </StackLayout>
                                    
                                    <!-- è·¯ç·šæè¿° -->
                                    <Label Grid.Row="1" Grid.Column="0" 
                                           Text="{Binding Description}" 
                                           FontSize="14"
                                           TextColor="Black"/>
                                    
                                    <!-- äº¤é€šç‹€æ³ -->
                                    <StackLayout Grid.Row="2" Grid.Column="0" Orientation="Horizontal" Spacing="4" Margin="0,4,0,0">
                                        <BoxView BackgroundColor="{Binding TrafficColor}" 
                                                 WidthRequest="12" 
                                                 HeightRequest="3" 
                                                 CornerRadius="1.5"
                                                 VerticalOptions="Center"/>
                                        <Label Text="{Binding TrafficInfo}" 
                                               FontSize="12" 
                                               TextColor="Gray"/>
                                    </StackLayout>
                                    
                                    <!-- é–‹å§‹å°ŽèˆªæŒ‰éˆ• -->
                                    <Button Grid.Row="0" Grid.RowSpan="3" Grid.Column="2"
                                            Text="é–‹å§‹å°Žèˆª"
                                            BackgroundColor="Green"
                                            TextColor="White"
                                            CornerRadius="20"
                                            FontSize="14"
                                            WidthRequest="80"
                                            HeightRequest="40"
                                            Clicked="OnStartNavigationClicked"/>
                                    
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Grid>
        </Grid>
        
        <!-- Google Maps é¢¨æ ¼å…¨èž¢å¹•å°Žèˆªæ¨¡å¼ (å°Žèˆªæ™‚é¡¯ç¤º) -->
        <Grid x:Name="NavigationMode" 
              IsVisible="{Binding IsNavigating}">
            
            <!-- å…¨èž¢å¹•åœ°åœ– -->
            <mapsui:MapControl x:Name="NavigationMapView" />
            
            <!-- é ‚éƒ¨å°ŽèˆªæŒ‡ç¤ºå¡ç‰‡ - Google Maps é¢¨æ ¼ -->
            <Border x:Name="NavigationInstructionCard"
                    BackgroundColor="White"
                    Stroke="LightGray"
                    StrokeShape="RoundRectangle 16"
                    StrokeThickness="1"
                    VerticalOptions="Start"
                    Margin="16,50,16,0"
                    Padding="20">
                <Border.Shadow>
                    <Shadow Brush="Black" Opacity="0.3" Radius="8" Offset="0,2"/>
                </Border.Shadow>
                
                <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="80,*,Auto">
                    
                    <!-- å¤§åž‹æ–¹å‘ç®­é ­ - Google Maps é¢¨æ ¼ -->
                    <Border Grid.Row="0" Grid.RowSpan="2" Grid.Column="0"
                            BackgroundColor="#E3F2FD"
                            StrokeShape="RoundRectangle 35"
                            WidthRequest="70"
                            HeightRequest="70"
                            VerticalOptions="Center"
                            HorizontalOptions="Center">
                        <Label x:Name="NavigationDirectionArrow"
                               Text="{Binding CurrentInstruction.ArrowIcon}"
                               FontSize="36"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"
                               TextColor="#1976D2"/>
                    </Border>
                    
                    <!-- å°ŽèˆªæŒ‡ç¤ºæ–‡å­— -->
                    <StackLayout Grid.Row="0" Grid.Column="1" 
                                 VerticalOptions="Center"
                                 Margin="16,0">
                        <!-- è·é›¢ -->
                        <Label x:Name="NavigationDistanceText"
                               Text="{Binding CurrentInstruction.Distance}"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="#666"/>
                        
                        <!-- æŒ‡ç¤ºæ–‡å­— -->
                        <Label x:Name="NavigationInstructionText"
                               Text="{Binding CurrentInstruction.Text}"
                               FontSize="24"
                               FontAttributes="Bold"
                               TextColor="Black"
                               Margin="0,4,0,0"/>
                        
                        <!-- è¡—é“åç¨± (å¦‚æžœæœ‰) -->
                        <Label x:Name="NavigationStreetName"
                               Text="{Binding CurrentInstruction.StreetName}"
                               FontSize="16"
                               TextColor="#666"
                               Margin="0,2,0,0"/>
                    </StackLayout>
                    
                    <!-- å°ŽèˆªæŽ§åˆ¶æŒ‰éˆ• -->
                    <StackLayout Grid.Row="0" Grid.RowSpan="2" Grid.Column="2" 
                                 Orientation="Vertical" 
                                 Spacing="8"
                                 VerticalOptions="Center">
                        <Button x:Name="NavigationMuteButton"
                                Text="ðŸ”Š"
                                WidthRequest="44"
                                HeightRequest="44"
                                CornerRadius="22"
                                BackgroundColor="#F5F5F5"
                                TextColor="#666"
                                FontSize="20"
                                Clicked="OnMuteToggleClicked"/>
                        <Button x:Name="NavigationMenuButton"
                                Text="â‹®"
                                WidthRequest="44"
                                HeightRequest="44"
                                CornerRadius="22"
                                BackgroundColor="#F5F5F5"
                                TextColor="#666"
                                FontSize="20"
                                Clicked="OnNavigationMenuClicked"/>
                    </StackLayout>
                    
                    <!-- è·¯ç·šé€²åº¦æ¢ -->
                    <ProgressBar Grid.Row="2" Grid.ColumnSpan="3"
                                 x:Name="NavigationProgressBar"
                                 Progress="{Binding RouteProgress}"
                                 ProgressColor="#1976D2"
                                 BackgroundColor="#E0E0E0"
                                 HeightRequest="4"
                                 Margin="0,16,0,0"/>
                </Grid>
            </Border>
            
            <!-- åº•éƒ¨ç‹€æ…‹åˆ— - Google Maps é¢¨æ ¼ -->
            <Border x:Name="NavigationStatusBar"
                    BackgroundColor="White"
                    Stroke="LightGray"
                    StrokeShape="RoundRectangle 20"
                    StrokeThickness="1"
                    VerticalOptions="End"
                    HorizontalOptions="Center"
                    Margin="16,0,16,40"
                    Padding="20,12">
                <Border.Shadow>
                    <Shadow Brush="Black" Opacity="0.2" Radius="6" Offset="0,2"/>
                </Border.Shadow>
                
                <StackLayout Orientation="Horizontal" Spacing="24">
                    <!-- é è¨ˆåˆ°é”æ™‚é–“ -->
                    <StackLayout Spacing="2" HorizontalOptions="Center">
                        <Label Text="{Binding EstimatedArrivalTime}"
                               FontSize="20"
                               FontAttributes="Bold"
                               TextColor="#1976D2"
                               HorizontalOptions="Center"/>
                        <Label Text="é è¨ˆåˆ°é”"
                               FontSize="12"
                               TextColor="#666"
                               HorizontalOptions="Center"/>
                    </StackLayout>
                    
                    <!-- åˆ†éš”ç·š -->
                    <BoxView WidthRequest="1"
                             HeightRequest="40"
                             BackgroundColor="#E0E0E0"
                             VerticalOptions="Center"/>
                    
                    <!-- å‰©é¤˜æ™‚é–“ -->
                    <StackLayout Spacing="2" HorizontalOptions="Center">
                        <Label Text="{Binding RemainingTime}"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="Black"
                               HorizontalOptions="Center"/>
                        <Label Text="å‰©é¤˜æ™‚é–“"
                               FontSize="12"
                               TextColor="#666"
                               HorizontalOptions="Center"/>
                    </StackLayout>
                    
                    <!-- åˆ†éš”ç·š -->
                    <BoxView WidthRequest="1"
                             HeightRequest="40"
                             BackgroundColor="#E0E0E0"
                             VerticalOptions="Center"/>
                    
                    <!-- å‰©é¤˜è·é›¢ -->
                    <StackLayout Spacing="2" HorizontalOptions="Center">
                        <Label Text="{Binding RemainingDistance}"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="Black"
                               HorizontalOptions="Center"/>
                        <Label Text="å‰©é¤˜è·é›¢"
                               FontSize="12"
                               TextColor="#666"
                               HorizontalOptions="Center"/>
                    </StackLayout>
                </StackLayout>
            </Border>
            
            <!-- å³ä¸‹è§’æŽ§åˆ¶æŒ‰éˆ•ç¾¤çµ„ - Google Maps é¢¨æ ¼ -->
            <StackLayout x:Name="NavigationControlButtons"
                         Orientation="Vertical"
                         Spacing="12"
                         VerticalOptions="End"
                         HorizontalOptions="End"
                         Margin="16,0,16,140">
                
                <!-- é‡æ–°ç½®ä¸­æŒ‰éˆ• -->
                <Button x:Name="RecenterButton"
                        Text="ðŸŽ¯"
                        WidthRequest="56"
                        HeightRequest="56"
                        CornerRadius="28"
                        BackgroundColor="White"
                        TextColor="#666"
                        FontSize="24"
                        Clicked="OnRecenterClicked">
                    <Button.Shadow>
                        <Shadow Brush="Black" Opacity="0.2" Radius="6" Offset="0,2"/>
                    </Button.Shadow>
                </Button>
                
                <!-- ç¸®æ”¾æŽ§åˆ¶ -->
                <StackLayout Spacing="0">
                    <Button x:Name="ZoomInButton"
                            Text="+"
                            WidthRequest="56"
                            HeightRequest="44"
                            CornerRadius="8"
                            BackgroundColor="White"
                            TextColor="#666"
                            FontSize="24"
                            FontAttributes="Bold"
                            Clicked="OnZoomInClicked">
                        <Button.Shadow>
                            <Shadow Brush="Black" Opacity="0.2" Radius="6" Offset="0,2"/>
                        </Button.Shadow>
                    </Button>
                    <Button x:Name="ZoomOutButton"
                            Text="âˆ’"
                            WidthRequest="56"
                            HeightRequest="44"
                            CornerRadius="8"
                            BackgroundColor="White"
                            TextColor="#666"
                            FontSize="24"
                            FontAttributes="Bold"
                            Clicked="OnZoomOutClicked">
                        <Button.Shadow>
                            <Shadow Brush="Black" Opacity="0.2" Radius="6" Offset="0,2"/>
                        </Button.Shadow>
                    </Button>
                </StackLayout>
            </StackLayout>
            
            <!-- å·¦ä¸Šè§’é€€å‡ºå°ŽèˆªæŒ‰éˆ• -->
            <Button x:Name="ExitNavigationButton"
                    Text="âœ•"
                    WidthRequest="44"
                    HeightRequest="44"
                    CornerRadius="22"
                    BackgroundColor="White"
                    TextColor="#666"
                    FontSize="20"
                    VerticalOptions="Start"
                    HorizontalOptions="Start"
                    Margin="16,50,0,0"
                    Clicked="OnExitNavigationClicked">
                <Button.Shadow>
                    <Shadow Brush="Black" Opacity="0.2" Radius="6" Offset="0,2"/>
                </Button.Shadow>
            </Button>
        </Grid>
    </Grid>
</ContentPage>